<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æº–å‰‡å¿«æ†¶é€š (Doctrine Flash)</title>
    <style>
        /* --- æ ¸å¿ƒæ¨£å¼ï¼šæš—é»‘æ¨¡å¼èˆ‡è¡Œå‹•å„ªå…ˆ --- */
        body {
            background-color: #121212; /* æ·±ç°èƒŒæ™¯ */
            color: #e0e0e0; /* æ·ºç°æ–‡å­—ï¼Œå°æ¯”åº¦é©ä¸­ */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }

        /* å°èˆªåˆ— */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        .progress { color: #4caf50; font-weight: bold; }

        /* å¡ç‰‡å€åŸŸ */
        .card-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .question-box {
            font-size: 1.2rem;
            font-weight: bold;
            color: #81c784; /* æå•ç”¨äº®ç¶ è‰² */
        }

        .answer-box {
            font-size: 1.1rem;
            line-height: 1.8;
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            min-height: 150px;
            position: relative;
        }

        /* æŒ–ç©ºäº’å‹•è¨­è¨ˆ */
        .cloze-word {
            border-bottom: 2px solid #555;
            padding: 0 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cloze-word.hidden {
            background-color: #333;
            color: #333; /* æ–‡å­—éš±è— */
            user-select: none;
        }
        .cloze-word.revealed {
            background-color: transparent;
            color: #fff;
            border-bottom-color: #4caf50;
        }

        /* åº•éƒ¨æŒ‰éˆ•å€ (SRS) */
        .action-area {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: auto;
        }

        .btn {
            padding: 15px 0;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
        }
        .btn-fail { background-color: #e57373; }
        .btn-hard { background-color: #ffb74d; color: #333; }
        .btn-easy { background-color: #81c784; color: #333; }
        
        /* åŒ¯å…¥å€ (é è¨­éš±è—) */
        #importer-screen {
            display: none; /* åˆ‡æ›ç”¨ */
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #121212;
            padding: 20px;
            box-sizing: border-box;
            z-index: 100;
        }
        textarea {
            width: 100%;
            height: 200px;
            background: #1e1e1e;
            color: #fff;
            border: 1px solid #333;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <div id="study-screen">
        <div class="header">
            <button onclick="toggleImporter()" style="background:none; border:1px solid #555; color:#fff; padding:5px;">â˜° é¸å–®/åŒ¯å…¥</button>
            <span class="progress">é€²åº¦ <span id="current-idx">1</span>/<span id="total-count">0</span></span>
        </div>

        <div class="card-container">
            <div class="question-box" id="question-text">
                (è«‹å…ˆé»æ“Šé¸å–®åŒ¯å…¥é¡Œåº«)
            </div>
            
            <div class="answer-box" id="answer-text">
                </div>
            
            <div style="text-align: center; margin-top:10px;">
                <button onclick="toggleMaskLevel()" class="btn" style="background:#333; font-size:0.9rem; padding:8px 20px;">
                    ğŸ‘ï¸ åˆ‡æ›é®ç½©ç­‰ç´š (Lv1/Lv2)
                </button>
            </div>
        </div>

        <div class="action-area">
            <button class="btn btn-fail" onclick="nextCard()">å¿˜è¨˜<br><span style="font-size:0.7rem">1åˆ†å¾Œ</span></button>
            <button class="btn btn-hard" onclick="nextCard()">æ¨¡ç³Š<br><span style="font-size:0.7rem">10åˆ†å¾Œ</span></button>
            <button class="btn btn-easy" onclick="nextCard()">ç°¡å–®<br><span style="font-size:0.7rem">4å¤©å¾Œ</span></button>
        </div>
    </div>

    <div id="importer-screen">
        <h2>åŒ¯å…¥ Line è¨˜äº‹æœ¬</h2>
        <p style="color:#aaa; font-size:0.9rem">æ ¼å¼ç¯„ä¾‹ï¼š<br>Q: è¡›å“¨ä¸€èˆ¬å®ˆå‰‡?<br>A: æœè£æ•´é½Šï¼Œé…ä»¶å…‰äº®...</p>
        <textarea id="import-input" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ–‡å­—..."></textarea>
        <button class="btn btn-easy" style="width:100%" onclick="processImport()">è½‰æ›ä¸¦é–‹å§‹åˆ·é¡Œ</button>
        <button class="btn" style="width:100%; background:none; margin-top:10px;" onclick="toggleImporter()">å–æ¶ˆ</button>
    </div>

    <script>
        // --- 1. è³‡æ–™çµæ§‹èˆ‡ç‹€æ…‹ ---
        let cards = [];
        let currentIndex = 0;
        let maskLevel = 2; // é è¨­é–‹å•Ÿé®ç½©

        // --- 2. æ ¸å¿ƒé‚è¼¯ï¼šRegex åŒ¯å…¥å™¨ ---
        function processImport() {
            const text = document.getElementById('import-input').value;
            // Regex è§£æï¼šæ”¯æ´ Q:/A: æˆ– å•:/ç­”: çš„æ ¼å¼
            // èªªæ˜ï¼šæ•æ‰ Q é–‹é ­åˆ°æ›è¡Œï¼Œæ¥è‘—æ•æ‰ A åˆ°ä¸‹ä¸€å€‹ Q ä¹‹å‰çš„æ‰€æœ‰å…§å®¹
            const regex = /(?:Q:|å•ï¼š|é¡Œç›®ï¼š)(.*?)\n(?:A:|ç­”ï¼š|ç­”æ¡ˆï¼š)([\s\S]*?)(?=(?:Q:|å•ï¼š|é¡Œç›®ï¼š|$))/gi;
            
            let match;
            cards = [];
            while ((match = regex.exec(text)) !== null) {
                cards.push({
                    q: match[1].trim(),
                    a: match[2].trim()
                });
            }

            if (cards.length > 0) {
                document.getElementById('total-count').innerText = cards.length;
                currentIndex = 0;
                renderCard();
                toggleImporter(); // é—œé–‰åŒ¯å…¥é 
            } else {
                alert("ç„¡æ³•è­˜åˆ¥æ ¼å¼ï¼Œè«‹ç¢ºèªæ˜¯å¦æœ‰ Q: å’Œ A: æ¨™è¨˜");
            }
        }

        // --- 3. æ ¸å¿ƒé‚è¼¯ï¼šå¡ç‰‡æ¸²æŸ“èˆ‡æŒ–ç©º ---
        function renderCard() {
            if (cards.length === 0) return;
            const card = cards[currentIndex];
            document.getElementById('question-text').innerText = `Q: ${card.q}`;
            document.getElementById('current-idx').innerText = currentIndex + 1;

            // è™•ç†ç­”æ¡ˆé¡¯ç¤º (æŒ–ç©ºé‚è¼¯)
            const answerContainer = document.getElementById('answer-text');
            answerContainer.innerHTML = ''; // æ¸…ç©º

            // ç°¡å–®æ–·è©ï¼šä»¥æ¨™é»ç¬¦è™Ÿæˆ–ç©ºæ ¼åˆ‡åˆ†ï¼Œä¿ç•™æ¨™é»
            // é€™è£¡ç”¨æ­£å‰‡å°‡æ–‡å­—æ‹†æˆ [æ–‡å­—, æ¨™é», æ–‡å­—...] çš„é™£åˆ—
            const segments = card.a.split(/([ï¼Œã€‚ã€ï¼›ï¼š\s\n]+)/);

            segments.forEach(seg => {
                if (!seg) return;
                // å¦‚æœæ˜¯æ¨™é»ç¬¦è™Ÿæˆ–ç©ºç™½ï¼Œç›´æ¥é¡¯ç¤º
                if (/[ï¼Œã€‚ã€ï¼›ï¼š\s\n]/.test(seg)) {
                    const span = document.createElement('span');
                    span.innerText = seg;
                    answerContainer.appendChild(span);
                } else {
                    // å¦‚æœæ˜¯æ–‡å­—ï¼Œå»ºç«‹äº’å‹•å¼æŒ–ç©ºå…ƒä»¶
                    const span = document.createElement('span');
                    span.innerText = seg;
                    span.className = 'cloze-word';
                    
                    // æ ¹æ“š Level æ±ºå®šæ˜¯å¦é è¨­éš±è—
                    if (maskLevel === 2) {
                        span.classList.add('hidden');
                    }
                    
                    // é»æ“Šäº‹ä»¶ï¼šåˆ‡æ›é¡¯ç¤º/éš±è—
                    span.onclick = () => span.classList.toggle('hidden');
                    answerContainer.appendChild(span);
                }
            });
        }

        // --- 4. è¼”åŠ©åŠŸèƒ½ ---
        function toggleMaskLevel() {
            maskLevel = maskLevel === 1 ? 2 : 1; // 1:å…¨é¡¯, 2:æŒ–ç©º
            renderCard(); // é‡æ–°æ¸²æŸ“
        }

        function nextCard() {
            if (cards.length === 0) return;
            // ç°¡å–®è¼ªæ’­ (çœŸå¯¦ SRS éœ€çµåˆæ¼”ç®—æ³•)
            currentIndex = (currentIndex + 1) % cards.length;
            renderCard();
        }

        function toggleImporter() {
            const screen = document.getElementById('importer-screen');
            screen.style.display = screen.style.display === 'block' ? 'none' : 'block';
        }

        // é è¨­è¼‰å…¥ä¸€é¡Œç¯„ä¾‹
        window.onload = () => {
             document.getElementById('import-input').value = 
`Q: è¡›å“¨å…µä¸€èˆ¬å®ˆå‰‡ç‚ºä½•ï¼Ÿ
A: æœè£æ•´é½Šï¼Œé…ä»¶å…‰äº®ï¼Œä¸å¸è¸ï¼Œä¸é£²é…’ã€‚
Q: ç”¨æ§æ™‚æ©Ÿç‚ºä½•ï¼Ÿ
A: 1. ç”Ÿå‘½å—æš´è¡Œè„…è¿«æ™‚ã€‚\n2. è¨­æ–½å—åŠ«å¥ªç ´å£æ™‚ã€‚`;
             processImport(); // è‡ªå‹•è·‘ä¸€æ¬¡ç¯„ä¾‹
        };
    </script>
</body>
</html>
